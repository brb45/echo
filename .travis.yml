language: java
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
stages:
- test
- name: docker
  if: branch = master AND type IN (push)
- name: deploy
  if: branch = master AND type IN (push)
- name: healthcheck
  if: branch = master AND type IN (push)
jobs:
  include:
  - stage: test
    install: true
    script: "./go test-unit"
  - stage: docker
    script:
    - docker login -u $DOCKER_USER -p $DOCKER_PASSWORD $DOCKER_REGISTRY
    - docker build . --tag $DOCKER_REGISTRY/echo
    - docker push $DOCKER_REGISTRY/echo
  - stage: deploy
    before_deploy:
    - openssl aes-256-cbc -K $encrypted_8ff1c1d2d1ae_key -iv $encrypted_8ff1c1d2d1ae_iv
      -in deploy_rsa.enc -out deploy_rsa -d
    - chmod 600 deploy_rsa
    script: skip
    deploy:
      provider: script
      skip_cleanup: true
      script: ssh -i deploy_rsa $DEPLOY_USER@$DEPLOY_HOST "sh ${DEPLOY_PATH}/bin/update
        echo"
  - stage: healthcheck
    script: curl --connect-timeout 60 -s -f -o /dev/null "${SITE_URL}/hello"
env:
  global:
  - secure: GS1aI5rD3Ms2ibB8iUvF+ylHUm/skUmgH0+WzHtMt5ggca5ivlTWSaVNeRV1YAvrbMhRJJDrKskYIfOMtP/7Z5uKCwtDmWEOFrV8Mr5PM2W/9t/9JDy06qTmOPgReEdhNan3n3DlrJIHqD5577HWdJsPUZE/pIB5pXyBR4dnWzSVlX9KcjsxXX77S3xf1gekdSfbvC0DCYK7wJa9b8nu/Thvanyc1zOx8BZY1U491MhYThT8dizhXM/EhmEqgeYjiR93gePa9UTvYstvSAqT3JsGZQnwjzqXU/iVPuri4MIaMwwqYozZKmNfZYf6V+HIHOw0nX08XFUZXAdenohZpm1x6k4YOHqBeLh6GO0Fc9muwv61yEFR4Cbwvl5shzBGmVhFOdtAQrVGoXjN39f6vnJzOy2hI2aGCbSdW3+JbjzP3wEk5V8DYGmd+4r54WVOcj4D+eAttTmNDFD6+ldGAGoPpBubn0UPwdkRXYsg5akRpvjOW9201q3DcuYEK4fEa9zKNpWcCmV1kkyTWmLHOhYTpvtiyfnOQlmeOZrjLLMLVWwnuATQlE5N25uEesEhxvWZDwi77XOlBGvXrif9fQpNfpg866P0d1d44rFtILR9XpsckmaDeQdlgxERAiUY+VFSfR7O5x4BjSSpRqzSxXRQ3a0H47QEP+2pnq6SNHY=
  - secure: Vt7ENYq5GNIb2K0R7127LEMKXxHdPY51R0Flcwk5pGuttonoTo9Xvq34mNaNTAZkDK51ICjCbeG9hCAbyhZ0E5i5GYohMZHZBT5Eejd2RfI8tBU/kxDW8vPr48Y+jy36hDKiJyiZ0Wa2VEf0uPO13UOHx7DshaWHaYYVyy5U5jVOU+kBT1WJBRpIpnmX6DFJGWuoQNGpa6t3l7Ui4rnD5Treq5KijD7ztLQSZBd47ZDMDR+yq2y0GvUKn4k/ns2+tKDvTNHI0nBnPJ/pAc+7wGgxtHz1TUr2mLBUhGdfa6vFbSQaES+89sjAd5RGJnLDUpAidxJxXlDyPKYsOV/1pcQQAA/mUmoq16s+INm4foXabRtWYhtiHNU2gEm8RjFDuGy7wCnAjWACqn4RRx0edjOZCPGaBwGaaPgr94A9JTboDZyOdmEHn1NdoXYkoN98FhVxH1BaIVGywSPIXE0b5cjvoBo5E9HTc6KGRCMd9RLY5fv6tW2CmN6hADBmvWYU9lQ3uI2XoebPdO46nXPX8qoKnyWq517GC1/8JQSWJys86tMWQe0Amlvv5L5A28AWuxQVhEgOHXRzjRGO2Tx0wK9C+C82scRIfz96pSFfbpIOmCTLhFE+TX7ld/WcVI5O69Oxl7SOisEOWZnJyU/li4LPTVNmOG4AOf2HEKPuRhg=
  - secure: WbkZN8OnefUrHe5rUk+lPndT933qn9LNP7eGloceKb8B9SadvBjYxUba90Vpu/+Qvu+SNnsjNra+2yuG97hfyvGS8WfGfBGu6gbjs3itbLFDHpY5Hde2PH+a5Tt6JlXpL7M2yFjT3RjaXCK1gvg4dXp7jcA4b/vnhFA8xcscjIxI5G/H/AIPFubVnKs6kIVAffOdhKdVFnyalyDl08GA45LXGvHB0wLGlAkhJ8TSR5k1NLTDfWI0dh3Fmb0sPOGEeSzNpmoj6gmLgqJI0L8VjtY9QqnkRDx4S/F7W+lPom8SMfMn5oOaITXNHi7hKhaebc4iUI223VAMkL4Dr9SeIzex0EKzAFZPceRYQkD49sfregTFfMgSXmMXdIW5BUy2ySz3xZSMWA73klovjCbWHQmSAShOcyd0/tao05GGRJ0zkjPjSilNcITYSoszjDGcQfvHQRZdoXbjK5WWSg8sWOk0emqZy5Xp7bn/OmqR1t3iGp3nBenzZovc4XDfoIM7/iIfTZxWcACnDDNqaA1DXZopiMa9aCu/MUXviBJ8gVepkvVkPzluDMeNNwJY9QmGh9TecL5IHraoT+k1uaNMM0ZF2hIe3xoJ23WUt6POLcNBVirnoDVXDhRrcNQzKduDqz6mPuSnTOxicH57RGZeb/Grg12Wry4snCZK2LIlzTs=
  - secure: rgSoB4ELw/1+rut7BGckrKnzng55Lxnf7lb6RLZpjwBxa1mZHd4UEoxPlXZOqH0kO/VsuHHphl/oI4ZEwMkm2V89lw87LNVN6/Jeg6Gvw/kdtGtpA6Pv+1PquAk+C5s2Ca5IgiSRFzT2NiwxkXaqvyBuduhXYdRSasWVcqGcpQqHedFXxlqpcEpvNGnmeVRY5+ytOHEjb4TEUDpES87luz/bFpFcUPcerqLLt6Mz/UfMlLpK3j/swAAQtyjD/nD4Ednr8iv2uvuryTbTjqL7Zgttc8okk2PqSvcx1Yx0zqEiwA5HcRlvbNzs0qyV6azuphcv5+Hojr0nE4qaBppeak/lmuvz/va/4NeabnfncnxCaS+HV+Va+fuly32GwXJAh1cb0XWmvHz18SZkYfTyshnUARPndCtLr0xieIm9uNu1OUVY7GFthE32CYFKWM46UipumiwxxEu9nmYQPGitRUifxUEw6EyGJ1NWo3YH9V5t/llPcs4OUv7NTVhjMetfH8jV2DbFy1Jj2oIEHFctVhbfltA/XHyWnXl4CKKM+3FhjI9PsY59ESo0LiMzDVPtwgqz9paKf1TuBucq1aMLMi3Iqc/fkMjXOqdhm5ETyblhdLplyhltjWJWNEkC2kaXUMaCf/t3Iaw4wDY/m8aAA87NUZZ7ugpTFWIFTZHnmQo=
  - secure: IRc86/UV3dEkIF45Hn15u2DH9YWwX5RhM1mVLfIk0JIwZ1wd93BZJDOCDsqnTO3QUFsD2aTbqGD4QSPy0x0EIdeioefo1OWS2Qp+/auZ63JvIUUVYK6+Iij46PVCckjDLFHgsvG3QMoRxH5pgJ+bRgkcddz8sOH7b4ZaXEM+uFng0EcpI3/mpZk3HrKo5nBto7IUTn87mO38do+QCrbRz1iSGulZ5l3rXwiohd270yIZ5q16FoSGY7kTDVpWmzFctwVYQ+jOvrdj2rZnzphHYIlw3x78bCXKU3mFLFdyEisfTT1K41YtrxK++trodeQpFumfq1oK9UXn7Qg3pVgDe1cjhP+kO3Lml93x6sNoCOCiqllbsPfGG7cFNiQJ6opJCMrHtEnjIaHKWImaHmdjfb3ueYmtQhG4IoeuyuYYFqk2BCn8zsYg9+XJZ9WJrP6/QgtvI/WU+U4oNNZhQIQUS+L945ugyYmXH0jCrZD0Dyez7GWfbgT7f+SqqhJF1cLzwMg9lZ5GJNoHW2OQTwn8qzbLAiEGHR2dY4UElyjB9ox4ceJpxe6OX8o8fcGRv62m5C6doQatZMxRqmqSMiGuFG3hJlz2+vrnMuNKdhwm9JWwqXIYiL+k1+tI1t2q7G0tctzH5STgUaqu0afujFLmENes7+mhnsSateaUv8KrUYA=
  - secure: StS8BA/4sbPoDHKr9zC5onOdpKJiOl/r3ElawEYlSlYG/wsDT5WVUFwqXGf0nv7NARQj58Ohz0Rl9y3aVNOlZ9A/LQB9pKhS+stv+sXx4MMREKfCTs+m1hnX3pS3Ue5x6pdnnV3an5qs/v1o5UhSRL5pQroE/fpjs8QRRPZhcQ8kbR42VNssHleJUn4vDuiZM3Wi/t/yJUJ3yRAmqq2aSCIN/GKfvfJ3C9kVL71nBzXnfNUNiSEGz1BMmOo3aRuSrez1gwIK5Jh+fjZO+CjY0G3D2PuFT/rP3VvJkvSj2d5or/U8yY1VSZ6xUCV4Gad07T7JxRz+QUr3Q2LHKCME22dAj7UrmkjNEK74HnaglhgptdwuU+yHvv/Q6NUcGLfVVpbErt8kPHDk5z5ydS/4nAe2PJkHndyP+vxZ0r8V9QcpAWFbLLmoy6Jt1+R3hXCxMjnQ5wCcgmdZZpVC3FAPyE+IRglUtriAV7RPDxmOTyn7MBAMWNgsC/TWKyXRcYtMI4GoFKaXJHvRECi1xWTEcPZLDXv0WAdwD40GLqk+2juLNAXBCHfN4xvh23FDJTQREAO2sI5XoowfrYRpdfGZrUnBWlDRrnsEalwe15pABtnz1BJz3LrSPfkfa3Gg00dYXqIomKH9ki9RvNV4JytWM9yxjP0xg5adDZ0NgDsaGmI=
  - secure: fT+duuORfHaPQGshcPHEA4BHtRFoVTPkqsy6hyJmS3AqWWyGyRQCfe6BIYhH6PFZXVHfJwYnM3kuwmDMadcSxeGjd9BXlNvs962eikmEJS1/zkTR0e1wkZ9qZ8BElybr4Xpb/r8b+lAIz1w2UKoDgvnkBvBLXixeAjCBtP+HsBt33kAkfJbSvKgo3leNlmciYHzY/dUOE1Ucz2DCLnHDemT6kQcBTh3nrEl4hR6g8SjwltPMk66Br6S3qJQcO6svKcQRC6YysMp6hZ9euEsxpURVXWsL4Z2Ye69OdwmlZ6sfczL3iPD7yLm1fY8NDN7cc9DqjR78YzBR58vQwI2r8LXpreJ3jbOJ7bKSMMhSqHRAnkNgXcibFwyFMfh8mOawuPPDfOYqp1GRIeYnOV+PFzUPJINAxBHfwOvzb8T3oHZTxE/oe69MPMDbj+AGIasI6LrSG5RdRG0oQqnM1qTJB3CDHRF/tAsS4/R0cmobY2+DSX1+NCMooPjnAhAPjHITu1nMVqopf/8IIZGlWe1YiJSiP8agKM2gPRPpq8dFqvRjXz73zfkXvjgM//r1tQJxhoAHHyoYPBtlPdon64Snzg7chijhx0dpM1p5IEBZQt2BrRO1m9YAobLkvpaJWJQ8/MGWoWo1viFKyZUloAm6QkDpgAGdbGXO7DC691PRHBQ=
